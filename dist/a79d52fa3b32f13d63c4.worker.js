!function(e){function t(e){function t(e,t){"ready"===b&&i("prepare"),_++,h.e(e,function(){function n(){_--,"prepare"===b&&(x[e]||s(e),0===_&&0===w&&a())}try{t.call(null,r)}finally{n()}})}var n=O[e];if(!n)return h;var r=function(t){return n.hot.active?O[t]?(O[t].parents.indexOf(e)<0&&O[t].parents.push(e),n.children.indexOf(t)<0&&n.children.push(t)):v=[e]:(console.warn("[HMR] unexpected require("+t+") from disposed module "+e),v=[]),h(t)};for(var o in h)Object.prototype.hasOwnProperty.call(h,o)&&(c?Object.defineProperty(r,o,function(e){return{configurable:!0,enumerable:!0,get:function(){return h[e]},set:function(t){h[e]=t}}}(o)):r[o]=h[o]);return c?Object.defineProperty(r,"e",{enumerable:!0,value:t}):r.e=t,r}function n(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],active:!0,accept:function(e,n){if("undefined"==typeof e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var i=0;i<e.length;i++)t._acceptedDependencies[e[i]]=n;else t._acceptedDependencies[e]=n},decline:function(e){if("undefined"==typeof e)t._selfDeclined=!0;else if("number"==typeof e)t._declinedDependencies[e]=!0;else for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:o,apply:l,status:function(e){return e?void y.push(e):b},addStatusHandler:function(e){y.push(e)},removeStatusHandler:function(e){var t=y.indexOf(e);t>=0&&y.splice(t,1)},data:m[e]};return t}function i(e){b=e;for(var t=0;t<y.length;t++)y[t].call(null,e)}function r(e){var t=+e+""===e;return t?+e:e}function o(e,t){if("idle"!==b)throw new Error("check() is only allowed in idle status");"function"==typeof e?(p=!1,t=e):(p=e,t=t||function(e){if(e)throw e}),i("check"),hotDownloadManifest(function(e,n){if(e)return t(e);if(!n)return i("idle"),void t(null,null);z={},P={},x={};for(var r=0;r<n.c.length;r++)P[n.c[r]]=!0;d=n.h,i("prepare"),u=t,f={};var o=0;s(o),"prepare"===b&&0===_&&0===w&&a()})}function s(e){P[e]?(z[e]=!0,w++,hotDownloadUpdateChunk(e)):x[e]=!0}function a(){i("ready");var e=u;if(u=null,e)if(p)l(p,e);else{var t=[];for(var n in f)Object.prototype.hasOwnProperty.call(f,n)&&t.push(r(n));e(null,t)}}function l(t,n){function o(e){for(var t=[e],n={},i=t.slice();i.length>0;){var r=i.pop(),e=O[r];if(e&&!e.hot._selfAccepted){if(e.hot._selfDeclined)return new Error("Aborted because of self decline: "+r);if(0===r)return;for(var o=0;o<e.parents.length;o++){var a=e.parents[o],l=O[a];if(l.hot._declinedDependencies[r])return new Error("Aborted because of declined dependency: "+r+" in "+a);t.indexOf(a)>=0||(l.hot._acceptedDependencies[r]?(n[a]||(n[a]=[]),s(n[a],[r])):(delete n[a],t.push(a),i.push(a)))}}}return[t,n]}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];e.indexOf(i)<0&&e.push(i)}}if("ready"!==b)throw new Error("apply() is only allowed in ready status");"function"==typeof t?(n=t,t={}):t&&"object"==typeof t?n=n||function(e){if(e)throw e}:(t={},n=n||function(e){if(e)throw e});var a={},l=[],c={};for(var u in f)if(Object.prototype.hasOwnProperty.call(f,u)){var p=r(u),y=o(p);if(!y){if(t.ignoreUnaccepted)continue;return i("abort"),n(new Error("Aborted because "+p+" is not accepted"))}if(y instanceof Error)return i("abort"),n(y);c[p]=f[p],s(l,y[0]);for(var p in y[1])Object.prototype.hasOwnProperty.call(y[1],p)&&(a[p]||(a[p]=[]),s(a[p],y[1][p]))}for(var w=[],_=0;_<l.length;_++){var p=l[_];O[p]&&O[p].hot._selfAccepted&&w.push({module:p,errorHandler:O[p].hot._selfAccepted})}i("dispose");for(var x=l.slice();x.length>0;){var p=x.pop(),z=O[p];if(z){for(var P={},L=z.hot._disposeHandlers,k=0;k<L.length;k++){var S=L[k];S(P)}m[p]=P,z.hot.active=!1,delete O[p];for(var k=0;k<z.children.length;k++){var D=O[z.children[k]];if(D){var R=D.parents.indexOf(p);R>=0&&D.parents.splice(R,1)}}}}for(var p in a)if(Object.prototype.hasOwnProperty.call(a,p))for(var z=O[p],j=a[p],k=0;k<j.length;k++){var C=j[k],R=z.children.indexOf(C);R>=0&&z.children.splice(R,1)}i("apply"),g=d;for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&(e[p]=c[p]);var M=null;for(var p in a)if(Object.prototype.hasOwnProperty.call(a,p)){for(var z=O[p],j=a[p],G=[],_=0;_<j.length;_++){var C=j[_],S=z.hot._acceptedDependencies[C];G.indexOf(S)>=0||G.push(S)}for(var _=0;_<G.length;_++){var S=G[_];try{S(a)}catch(e){M||(M=e)}}}for(var _=0;_<w.length;_++){var I=w[_],p=I.module;v=[p];try{h(p)}catch(e){if("function"==typeof I.errorHandler)try{I.errorHandler(e)}catch(e){M||(M=e)}else M||(M=e)}}return M?(i("fail"),n(M)):(i("idle"),void n(null,l))}function h(i){if(O[i])return O[i].exports;var r=O[i]={exports:{},id:i,loaded:!1,hot:n(i),parents:v,children:[]};return e[i].call(r.exports,r,r.exports,t(i)),r.loaded=!0,r.exports}var c=!1;try{Object.defineProperty({},"x",{get:function(){}}),c=!0}catch(e){}var u,f,d,p=!0,g="a79d52fa3b32f13d63c4",m={},v=[],y=[],b="idle",w=0,_=0,x={},z={},P={},O={};return h.m=e,h.c=O,h.p="",h.h=function(){return g},t(0)(0)}([function(e,t,n){"use strict";function i(e){var t=new o.RasterToGcode(e.settings);Object.assign(t,e.properties),t.on("progress",function(e){self.postMessage(r({event:"onProgress"},e))}).on("done",function(e){self.postMessage(r({event:"onDone"},e))}).on("abort",function(){self.postMessage({event:"onAbort"})}),self.postMessage({event:"start"}),t.run()}var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o=n(3);self.onmessage=function(e){"start"===e.data.cmd&&i(e.data)}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e){return e<0?0:e>255?255:e}function o(e,t,n){n&&(e[t]=r(255-e[t]),e[t+1]=r(255-e[t+1]),e[t+2]=r(255-e[t+2]))}function s(e,t,n){void 0!==n&&(e[t]=r(e[t]+n),e[t+1]=r(e[t+1]+n),e[t+2]=r(e[t+2]+n))}function a(e,t,n){void 0!==n&&(e[t]=r(n*(e[t]-128)+128),e[t+1]=r(n*(e[t+1]-128)+128),e[t+2]=r(n*(e[t+2]-128)+128))}function l(e,t,n){void 0!==n&&(e[t]=r(Math.exp(Math.log(255*(e[t]/255))*n)),e[t+1]=r(Math.exp(Math.log(255*(e[t+1]/255))*n)),e[t+2]=r(Math.exp(Math.log(255*(e[t+2]/255))*n)))}function h(e,t,n,i){if(d.indexOf(n)===-1)throw new Error("Unsupported grayscale algorithm: "+n);if("none"===n)return null;var o=void 0,s=e[t],a=e[t+1],l=e[t+2];switch(n){case"average":o=(s+a+l)/3;break;case"luma":o=.3*s+.59*a+.11*l;break;case"luma-601":o=.299*s+.587*a+.114*l;break;case"luma-709":o=.2126*s+.7152*a+.0722*l;break;case"luma-240":o=.212*s+.701*a+.087*l;break;case"desaturation":o=(Math.max(s,a,l)+Math.min(s,a,l))/2;break;case"decomposition-min":o=Math.min(s,a,l);break;case"decomposition-max":o=Math.max(s,a,l);break;case"red-chanel":o=s;break;case"green-chanel":o=a;break;case"blue-chanel":o=l}void 0!==i&&(o=parseInt(o/i)*i),o=parseInt(o),e[t]=r(o),e[t+1]=r(o),e[t+2]=r(o)}function c(e,t){t=Object.assign({},{smoothing:!1,brightness:0,contrast:0,gamma:0,grayscale:"none",shadesOfGray:256,invertColor:!1,dithering:!1},t||{});var n=e.getContext("2d");void 0!==n.imageSmoothingEnabled?n.imageSmoothingEnabled=t.smoothing:(n.mozImageSmoothingEnabled=t.smoothing,n.webkitImageSmoothingEnabled=t.smoothing,n.msImageSmoothingEnabled=t.smoothing,n.oImageSmoothingEnabled=t.smoothing);var i=n.getImageData(0,0,e.width,e.height),r=i.data,c=void 0,u=void 0,d=void 0,p=void 0;0!==t.contrast&&(c=259*(t.contrast+255)/(255*(259-t.contrast))),0!==t.brightness&&(u=t.brightness),0!==t.gamma&&(d=1/t.gamma),t.shadesOfGray>1&&t.shadesOfGray<256&&(p=255/(t.shadesOfGray-1));for(var g=0,m=r.length;g<m;g+=4)o(r,g,t.invertColor),s(r,g,u),a(r,g,c),l(r,g,d),h(r,g,t.grayscale,p);t.dithering&&(i=(0,f.default)(i)),n.putImageData(i,0,0)}Object.defineProperty(t,"__esModule",{value:!0}),t.canvasFilters=void 0;var u=n(4),f=i(u),d=["none","average","desaturation","decomposition-min","decomposition-max","luma","luma-601","luma-709","luma-240","red-chanel","green-chanel","blue-chanel"];t.canvasFilters=c,t.default=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasGrid=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(1),a=i(s),l=function(){function e(t){r(this,e),this.cellSize=1024,this.scaleRatio={x:1,y:1},this.filters={},Object.assign(this,t||{}),this.scaleRatio.x||(this.scaleRatio={x:this.scaleRatio,y:this.scaleRatio}),this.size={width:0,height:0,cols:0,rows:0},this.file=null,this.image=null,this.url=null,this.canvas=[],this.pixels=[]}return o(e,[{key:"load",value:function(e){return e instanceof File?this.loadFromFile(e):e instanceof Image?this.loadFromImage(e):"string"==typeof e||e instanceof URL?this.loadFromURL(e.trim()):Promise.reject(new Error("Unsupported input format."))}},{key:"_loadImage",value:function(e,t,n){var i=this,r=new Image;r.onload=function(e){i.loadFromImage(r).then(n).catch(t)},r.onerror=function(n){t(new Error("An error occurred while loading the image : "+e))},r.src=e}},{key:"loadFromFile",value:function(e){var t=this;return new Promise(function(n,i){e instanceof File||i(new Error("Input param must be a File object.")),t.file=e,t._loadImage(URL.createObjectURL(e),i,n)})}},{key:"loadFromURL",value:function(e){var t=this;return new Promise(function(n,i){e instanceof URL||"string"==typeof e||i(new Error("Input param must be a URL string or object."));var r=e instanceof URL?e:new URL(e);t.url=r,t._loadImage(r,i,n)})}},{key:"loadFromImage",value:function(e){var t=this;return new Promise(function(n,i){e instanceof Image||i(new Error("Input param must be a Image object.")),t.image=e,t._processImage(),n(t)})}},{key:"_processImage",value:function(){this.canvas=[],this.pixels=[];var e=Math.round(this.image.width*this.scaleRatio.x),t=Math.round(this.image.height*this.scaleRatio.y),n=Math.ceil(e/this.cellSize),i=Math.ceil(t/this.cellSize);this.size={width:e,height:t,cols:n,rows:i};var r=null,o=null,s=null,l=null,h=null,c=null,u=null,f=null,d=null,p=null;for(c=0;c<this.size.rows;c++){for(r=[],s=[],h=0;h<this.size.cols;h++)o=document.createElement("canvas"),0===h||h<this.size.cols-1?o.width=this.size.width<this.cellSize?this.size.width:this.cellSize:o.width=this.size.width%this.cellSize,0===c||c<this.size.rows-1?o.height=this.size.height<this.cellSize?this.size.height:this.cellSize:o.height=this.size.height%this.cellSize,l=o.getContext("2d"),l.fillStyle="white",l.fillRect(0,0,o.width,o.height),d=o.width/this.scaleRatio.x,p=o.height/this.scaleRatio.y,u=h*this.cellSize/this.scaleRatio.x,f=c*this.cellSize/this.scaleRatio.y,l.drawImage(this.image,u,f,d,p,0,0,o.width,o.height),(0,a.default)(o,this.filters),r.push(o),s.push(l.getImageData(0,0,o.width,o.height).data);this.pixels.push(s),this.canvas.push(r)}}},{key:"getPixel",value:function(e,t){if(e=parseInt(e),t=parseInt(t),isNaN(e)||isNaN(t))throw new Error("[x, y] params must be Integer.");if(e<0||e>=this.size.width)throw new Error("Out of range: x = "+e+", max: "+this.size.width);if(t<0||t>=this.size.height)throw new Error("Out of range: y = "+t+", max: "+this.size.height);var n=parseInt(e/this.cellSize),i=parseInt(t/this.cellSize);n&&(e-=this.cellSize*n),i&&(t-=this.cellSize*i);var r=this.cellSize;this.size.width<r?r=this.size.width:this.size.width<r*(n+1)&&(r=this.size.width%r);var o=t*(4*r)+4*e,s=this.pixels[i][n],a=s.slice(o,o+4);return{color:{r:a[0],g:a[1],b:a[2],a:a[3]},gray:(a[0]+a[1]+a[2])/3,grid:{col:n,row:i},coords:{x:e,y:t}}}}]),e}();t.CanvasGrid=l,t.default=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.RasterToGcode=void 0;var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),h=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var s=r.get;if(void 0!==s)return s.call(i)},c=n(2),u=i(c),f=function(e){function t(e){r(this,t),e=Object.assign({ppi:{x:254,y:254},toolDiameter:.1,rapidRate:1500,feedRate:500,rateUnit:"mm/min",beamRange:{min:0,max:1},beamPower:{min:0,max:100},milling:!1,zSafe:5,zSurface:0,zDepth:-10,passDepth:1,offsets:{X:0,Y:0},trimLine:!0,joinPixel:!0,burnWhite:!0,verboseG:!1,diagonal:!1,overscan:0,precision:{X:2,Y:2,S:4},nonBlocking:!0,filters:{smoothing:0,brightness:0,contrast:0,gamma:0,grayscale:"none",shadesOfGray:256,invertColor:!1},onProgress:null,onProgressContext:null,onDone:null,onDoneContext:null,onAbort:null,onAbortContext:null},e||{});var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(n.milling){if(n.zSafe<n.zSurface)throw new Error('"zSafe" must be greater to "zSurface"');n.passes=Math.abs(Math.floor(n.zDepth/n.passDepth))}if(n.toolDiameter<=0)throw new Error('"toolDiameter" must be positive');return n.ppi.x||(n.ppi={x:n.ppi,y:n.ppi}),n.ppm={x:parseFloat((2540/(100*n.ppi.x)).toFixed(10)),y:parseFloat((2540/(100*n.ppi.y)).toFixed(10))},n.scaleRatio={x:n.ppm.x/n.toolDiameter,y:n.ppm.y/n.toolDiameter},n.running=!1,n.gcode=null,n.gcodes=null,n.currentLine=null,n.lastCommands=null,n.outputSize={width:0,height:0},n.G1=["G",1],n.G0=["G",n.burnWhite?1:0],n.beamOffset=1e3*n.toolDiameter/2e3,n.realBeamRange={min:n.beamRange.max/100*n.beamPower.min,max:n.beamRange.max/100*n.beamPower.max},"mm/sec"===n.rateUnit&&(n.feedRate*=60,n.rapidRate&&(n.rapidRate*=60)),n._registerUserCallbacks(n),n}return s(t,e),l(t,[{key:"_registerUserCallbacks",value:function(e){e.onProgress&&this.on("progress",e.onProgress,e.onProgressContext),e.onAbort&&this.on("abort",e.onAbort,e.onAbortContext),e.onDone&&this.on("done",e.onDone,e.onDoneContext)}},{key:"_processImage",value:function(){h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processImage",this).call(this),this.outputSize={width:this.size.width*(1e3*this.toolDiameter)/1e3,height:this.size.height*(1e3*this.toolDiameter)/1e3}}},{key:"abort",value:function(){this.running=!1}},{key:"run",value:function(e){if(!this.running){this.running=!0,this.gcode=[],this.gcodes=[],this.lastCommands={},this.currentLine=null,e=e||{},this._registerUserCallbacks(e);var t=this.nonBlocking;return void 0!==e.nonBlocking&&(t=e.nonBlocking),this._addHeader(),this.diagonal?this._scanDiagonally(t):this._scanHorizontally(t),t?void 0:this.gcode}}},{key:"_addHeader",value:function(){this.gcode.push("; Generated by LaserWeb (lw.raster-to-gcode.js)","; Size       : "+this.outputSize.width+" x "+this.outputSize.height+" mm","; PPI        : x: "+this.ppi.x+" - y: "+this.ppi.y,"; PPM        : x: "+this.ppm.x+" - y: "+this.ppm.y,"; Tool diam. : "+this.toolDiameter+" mm","; Feed rate  : "+this.feedRate+" "+this.rateUnit),this.rapidRate&&this.gcode.push("; Rapid rate  : "+this.rapidRate+" "+this.rateUnit),this.milling?this.gcode.push("; Z safe     : "+this.zSafe,"; Z surface  : "+this.zSurface,"; Z depth    : "+this.zDepth):this.gcode.push("; Beam range : "+this.beamRange.min+" to "+this.beamRange.max,"; Beam power : "+this.beamPower.min+" to "+this.beamPower.max+" %");for(var e=["smoothing","trimLine","joinPixel","burnWhite","verboseG","diagonal"],t=e.length-1;t>=0;t--)this[e[t]]||e.splice(t,1);e.length&&this.gcode.push("; Options    : "+e.join(", ")),this.gcode.push(""),this.rapidRate&&this.gcode.push("G0 F"+this.rapidRate),this.gcode.push("G1 F"+this.feedRate),this.gcode.push("")}},{key:"_mapPixelPower",value:function(e){var t=this.milling?{min:0,max:this.zDepth}:this.realBeamRange;return e*(t.max-t.min)/255+t.min}},{key:"_command",value:function(e,t){if("object"===("undefined"==typeof t?"undefined":a(t))){for(var n=Array.prototype.slice.call(arguments),i=void 0,r=[],o=0,s=n.length;o<s;o++)i=this._command.apply(this,n[o]),i&&r.push(i);return r.length?r.join(" "):null}return t=t.toFixed(this.precision[e]||0),this.verboseG||t!==this.lastCommands[e]?(this.lastCommands[e]=t,e+t):null}},{key:"_getPixelPower",value:function(e,t,n){try{t=this.size.height-t-1;var i=this.getPixel(e,t);return 255-i.gray}catch(e){if(3===arguments.length)return n;throw e}}},{key:"_getPoint",value:function(e){var t=this.currentLine[e];return t?(t.G=t.s?["G",1]:this.G0,t.X=t.x*this.toolDiameter+this.offsets.X,t.Y=t.y*this.toolDiameter+this.offsets.Y,t.S=this._mapPixelPower(t.s),this.diagonal?(t.Y+=this.toolDiameter,t.first||t.lastWhite?(t.X+=this.beamOffset,t.Y-=this.beamOffset):(t.last||t.lastColored)&&(t.X-=this.beamOffset,t.Y+=this.beamOffset)):(t.Y+=this.beamOffset,t.first||t.lastWhite?t.X+=this.beamOffset:(t.last||t.lastColored)&&(t.X-=this.beamOffset)),t):null}},{key:"_trimCurrentLine",value:function(){for(var e=this.currentLine[0];e&&!e.p;)this.currentLine.shift(),e=this.currentLine[0];for(e=this.currentLine[this.currentLine.length-2];e&&!e.p;)this.currentLine.pop(),e=this.currentLine[this.currentLine.length-2];return this.currentLine.length}},{key:"_reduceCurrentLine",value:function(){if(this.currentLine.length<3)return this.currentLine.length;for(var e,t=this.currentLine.splice(1),n=this.currentLine[0].p,i=0,r=t.length-1;i<r;i++)e=t[i],n!==e.p&&this.currentLine.push(e),n=e.p;this.currentLine.push(t[i])}},{key:"_overscanCurrentLine",value:function(e){var t=this.overscan/this.ppm.x,n=this.currentLine[0],i=this.currentLine[this.currentLine.length-1];n.s&&(n.lastWhite=!0),i.s&&(i.lastColored=!0),e?i.s=0:n.s=0;var r={x:i.x+t,y:i.y,s:0,p:0},o={x:n.x-t,y:n.y,s:0,p:0};this.diagonal&&(o.y+=t,r.y-=t),this.currentLine.unshift(o),this.currentLine.push(r)}},{key:"_processCurrentLine",value:function(e){return this.milling?this._processMillingLine(e):this._processLaserLine(e)}},{key:"_processMillingLine",value:function(e){var t=this;if(!this._trimCurrentLine())return null;this.joinPixel&&this._reduceCurrentLine(),this.currentLine[0].first=!0,this.currentLine[this.currentLine.length-1].last=!0,e&&(this.currentLine=this.currentLine.reverse());var n=void 0,i=0,r=void 0,o=[],s=function(){r=t._command.apply(t,arguments),r&&o.push(r)};n=this._getPoint(i);for(var a=!1,l=void 0,h=void 0,c=function(e){for(s(["G",0],["Z",t.zSafe]),s(["G",0],["X",n.X],["Y",n.Y]),s(["G",0],["Z",t.zSurface]);n;)n.S?(a&&(s(["G",0],["Z",t.zSurface]),a=!1),l=n.S,h=t.passDepth*e,e<t.passes&&(l=Math.max(l,-h)),s(["G",1],["Z",t.zSurface+l]),s(["G",1],["X",n.X],["Y",n.Y])):(a&&(s(["G",1],["Z",t.zSurface]),a=!1),s(["G",0],["Z",t.zSafe]),s(["G",0],["X",n.X],["Y",n.Y])),(n.lastWhite||n.lastColored)&&(a=!0),n=t._getPoint(++i);s(["G",1],["Z",t.zSurface]),s(["G",0],["Z",t.zSafe])},u=1;u<=this.passes&&(c(u),o.length);u++)this.gcodes.length<u?this.gcodes.push([]):this.gcodes[u-1].push.apply(this.gcodes[u-1],o),i=0,o=[],n=this._getPoint(i),this.lastCommands={};return null}},{key:"_processLaserLine",value:function(e){var t=this;if(this.trimLine&&!this._trimCurrentLine())return null;this.joinPixel&&this._reduceCurrentLine(),this.overscan&&this._overscanCurrentLine(e),this.currentLine[0].first=!0,this.currentLine[this.currentLine.length-1].last=!0,e&&(this.currentLine=this.currentLine.reverse());var n=void 0,i=0,r=void 0,o=[],s=function(){r=t._command.apply(t,arguments),r&&o.push(r)};for(n=this._getPoint(i),s(this.G0,["X",n.X],["Y",n.Y],["S",0]),n=this._getPoint(++i);n;)s(n.G,["X",n.X],["Y",n.Y],["S",n.S]),n=this._getPoint(++i);return o.length?o:null}},{key:"_scanHorizontally",value:function(e){var t=this,n=0,i=0,r=void 0,o=void 0,s=void 0,a=void 0,l=this.size.width,h=this.size.height,c=!1,u=!1,f=!1,d=function(){for(t.currentLine=[],s=null,n=0;n<=l;n++)r=o=t._getPixelPower(n,i,o),u=s&&!s.p&&o,f=s&&s.p&&!o,!c&&s&&(r=s.p),s={x:n,y:i,s:r,p:o},u&&(s.lastWhite=!0),f&&(s.lastColored=!0),t.currentLine.push(s)},p=0,g=0,m=function(){a=t._processCurrentLine(c),p=Math.round(i/h*100),p>g&&t._onProgress({gcode:a,percent:p}),g=p,a&&(c=!c,t.gcode.push.apply(t.gcode,a))},v=function n(){return t.running?(d(),m(),i++,void(i<h?e?setTimeout(n,0):n():(t.milling&&t.gcodes.forEach(function(e){t.gcode.push.apply(t.gcode,e)}),t._onDone({gcode:t.gcode}),t.running=!1))):t._onAbort()};v()}},{key:"_scanDiagonally",value:function(e){var t=this,n=0,i=0,r=void 0,o=void 0,s=void 0,a=void 0,l=this.size.width,h=this.size.height,c=l+h-1,u=0,f=!1,d=!1,p=!1,g=function(e,n){for(t.currentLine=[],s=null,u++;;){if(n<-1||n==h)break;if(e<0||e>l)break;r=o=t._getPixelPower(e,n,o),d=s&&!s.p&&o,p=s&&s.p&&!o,!f&&s&&(r=s.p),s={x:e,y:n,s:r,p:o},d&&(s.lastWhite=!0),p&&(s.lastColored=!0),t.currentLine.push(s),e++,n--}},m=0,v=0,y=function(){a=t._processCurrentLine(f),m=Math.round(u/c*100),m>v&&t._onProgress({gcode:a,percent:m}),v=m,a&&(f=!f,t.gcode.push.apply(t.gcode,a))},b=function r(){return t.running?(g(n,i),y(),n?n++:i++,i===h&&(n++,i--),void(i<h&&n<l?e?setTimeout(r,0):r():(t._onDone({gcode:t.gcode}),t.running=!1))):t._onAbort()};b()}},{key:"_onProgress",value:function(e){}},{key:"_onDone",value:function(e){}},{key:"_onAbort",value:function(){}},{key:"on",value:function(e,t,n){var i=this,r="_on"+e[0].toUpperCase()+e.slice(1);if(!this[r]||"function"!=typeof this[r])throw new Error("Undefined event: "+e);return this[r]=function(e){return t.call(n||i,e)},this}},{key:"getHeightMap",value:function(e){var t=this;if(!this.running){this.running=!0;var n=[],i=0,r=0,o=this.size.width,s=this.size.height,a=0,l=0;e=e||{},this._registerUserCallbacks(e);var h=this.nonBlocking;void 0!==e.nonBlocking&&(h=e.nonBlocking);var c=function(){var e=[];for(i=0;i<o;i++)e.push(t._mapPixelPower(t._getPixelPower(i,r)));a=Math.round(r/s*100),a>l&&t._onProgress({pixels:e,percent:a}),l=a,n.push(e)},u=function e(){return t.running?(c(),r++,void(r<s?h?setTimeout(e,0):e():(t._onDone({heightMap:n}),t.running=!1))):t._onAbort()};return u(),h?void 0:n}}}]),t}(u.default);t.RasterToGcode=f,t.default=f},function(e,t){function n(e){for(var t,n,i=e.data,r=i.length,o=e.width,s=[],a=[],l=[],h=0;h<256;h++)s[h]=.299*h,a[h]=.587*h,l[h]=.11*h;for(var h=0;h<=r;h+=4)i[h]=Math.floor(s[i[h]]+a[i[h+1]]+l[i[h+2]]);for(var c=0;c<=r;c+=4)t=i[c]<150?0:255,n=Math.floor((i[c]-t)/23),i[c]=t,i[c+4]+=7*n,i[c+4*o-4]+=3*n,i[c+4*o]+=5*n,i[c+4*o+4]+=1*n,i[c+1]=i[c+2]=i[c];return e}e.exports=n}]);
//# sourceMappingURL=a79d52fa3b32f13d63c4.worker.js.map