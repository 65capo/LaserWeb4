!function(e){function t(e){function t(e,t){"ready"===b&&i("prepare"),w++,c.e(e,function(){function r(){w--,"prepare"===b&&(O[e]||o(e),0===w&&0===y&&a())}try{t.call(null,n)}finally{r()}})}var r=R[e];if(!r)return c;var n=function(t){return r.hot.active?R[t]?(R[t].parents.indexOf(e)<0&&R[t].parents.push(e),r.children.indexOf(t)<0&&r.children.push(t)):m=[e]:(console.warn("[HMR] unexpected require("+t+") from disposed module "+e),m=[]),c(t)};for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&(h?Object.defineProperty(n,s,function(e){return{configurable:!0,enumerable:!0,get:function(){return c[e]},set:function(t){c[e]=t}}}(s)):n[s]=c[s]);return h?Object.defineProperty(n,"e",{enumerable:!0,value:t}):n.e=t,n}function r(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],active:!0,accept:function(e,r){if("undefined"==typeof e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var i=0;i<e.length;i++)t._acceptedDependencies[e[i]]=r;else t._acceptedDependencies[e]=r},decline:function(e){if("undefined"==typeof e)t._selfDeclined=!0;else if("number"==typeof e)t._declinedDependencies[e]=!0;else for(var r=0;r<e.length;r++)t._declinedDependencies[e[r]]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var r=t._disposeHandlers.indexOf(e);r>=0&&t._disposeHandlers.splice(r,1)},check:s,apply:l,status:function(e){return e?void v.push(e):b},addStatusHandler:function(e){v.push(e)},removeStatusHandler:function(e){var t=v.indexOf(e);t>=0&&v.splice(t,1)},data:_[e]};return t}function i(e){b=e;for(var t=0;t<v.length;t++)v[t].call(null,e)}function n(e){var t=+e+""===e;return t?+e:e}function s(e,t){if("idle"!==b)throw new Error("check() is only allowed in idle status");"function"==typeof e?(p=!1,t=e):(p=e,t=t||function(e){if(e)throw e}),i("check"),hotDownloadManifest(function(e,r){if(e)return t(e);if(!r)return i("idle"),void t(null,null);L={},x={},O={};for(var n=0;n<r.c.length;n++)x[r.c[n]]=!0;d=r.h,i("prepare"),u=t,f={};var s=0;o(s),"prepare"===b&&0===w&&0===y&&a()})}function o(e){x[e]?(L[e]=!0,y++,hotDownloadUpdateChunk(e)):O[e]=!0}function a(){i("ready");var e=u;if(u=null,e)if(p)l(p,e);else{var t=[];for(var r in f)Object.prototype.hasOwnProperty.call(f,r)&&t.push(n(r));e(null,t)}}function l(t,r){function s(e){for(var t=[e],r={},i=t.slice();i.length>0;){var n=i.pop(),e=R[n];if(e&&!e.hot._selfAccepted){if(e.hot._selfDeclined)return new Error("Aborted because of self decline: "+n);if(0===n)return;for(var s=0;s<e.parents.length;s++){var a=e.parents[s],l=R[a];if(l.hot._declinedDependencies[n])return new Error("Aborted because of declined dependency: "+n+" in "+a);t.indexOf(a)>=0||(l.hot._acceptedDependencies[n]?(r[a]||(r[a]=[]),o(r[a],[n])):(delete r[a],t.push(a),i.push(a)))}}}return[t,r]}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];e.indexOf(i)<0&&e.push(i)}}if("ready"!==b)throw new Error("apply() is only allowed in ready status");"function"==typeof t?(r=t,t={}):t&&"object"==typeof t?r=r||function(e){if(e)throw e}:(t={},r=r||function(e){if(e)throw e});var a={},l=[],h={};for(var u in f)if(Object.prototype.hasOwnProperty.call(f,u)){var p=n(u),v=s(p);if(!v){if(t.ignoreUnaccepted)continue;return i("abort"),r(new Error("Aborted because "+p+" is not accepted"))}if(v instanceof Error)return i("abort"),r(v);h[p]=f[p],o(l,v[0]);for(var p in v[1])Object.prototype.hasOwnProperty.call(v[1],p)&&(a[p]||(a[p]=[]),o(a[p],v[1][p]))}for(var y=[],w=0;w<l.length;w++){var p=l[w];R[p]&&R[p].hot._selfAccepted&&y.push({module:p,errorHandler:R[p].hot._selfAccepted})}i("dispose");for(var O=l.slice();O.length>0;){var p=O.pop(),L=R[p];if(L){for(var x={},j=L.hot._disposeHandlers,z=0;z<j.length;z++){var P=j[z];P(x)}_[p]=x,L.hot.active=!1,delete R[p];for(var z=0;z<L.children.length;z++){var D=R[L.children[z]];if(D){var E=D.parents.indexOf(p);E>=0&&D.parents.splice(E,1)}}}}for(var p in a)if(Object.prototype.hasOwnProperty.call(a,p))for(var L=R[p],C=a[p],z=0;z<C.length;z++){var k=C[z],E=L.children.indexOf(k);E>=0&&L.children.splice(E,1)}i("apply"),g=d;for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(e[p]=h[p]);var A=null;for(var p in a)if(Object.prototype.hasOwnProperty.call(a,p)){for(var L=R[p],C=a[p],S=[],w=0;w<C.length;w++){var k=C[w],P=L.hot._acceptedDependencies[k];S.indexOf(P)>=0||S.push(P)}for(var w=0;w<S.length;w++){var P=S[w];try{P(a)}catch(e){A||(A=e)}}}for(var w=0;w<y.length;w++){var T=y[w],p=T.module;m=[p];try{c(p)}catch(e){if("function"==typeof T.errorHandler)try{T.errorHandler(e)}catch(e){A||(A=e)}else A||(A=e)}}return A?(i("fail"),r(A)):(i("idle"),void r(null,l))}function c(i){if(R[i])return R[i].exports;var n=R[i]={exports:{},id:i,loaded:!1,hot:r(i),parents:m,children:[]};return e[i].call(n.exports,n,n.exports,t(i)),n.loaded=!0,n.exports}var h=!1;try{Object.defineProperty({},"x",{get:function(){}}),h=!0}catch(e){}var u,f,d,p=!0,g="ec6ef5e051fb1735e264",_={},m=[],v=[],b="idle",y=0,w=0,O={},L={},x={},R={};return c.m=e,c.c=R,c.p="",c.h=function(){return g},t(0)(0)}([function(e,t,r){"use strict";function i(e){var t=new o.RasterToGcode(e.settings);Object.assign(t,e.properties),t.on("progress",function(e){self.postMessage(s({event:"onProgress"},e))}).on("done",function(e){self.postMessage(s({event:"onDone"},e))}).on("abort",function(){self.postMessage({event:"onAbort"})}),self.postMessage({event:"start"}),t.run()}function n(){rasterToGcode.abort()}var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},o=r(3);self.onmessage=function(e){"start"===e.data.cmd&&i(e.data)};(function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(i,"start","/Users/jorgerobles/repos_1/LaserWeb4/src/lib/workers/cam-raster.js"),__REACT_HOT_LOADER__.register(n,"abort","/Users/jorgerobles/repos_1/LaserWeb4/src/lib/workers/cam-raster.js"))})()},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e){return e<0?0:e>255?255:e}function s(e,t,r){r&&(e[t]=n(255-e[t]),e[t+1]=n(255-e[t+1]),e[t+2]=n(255-e[t+2]))}function o(e,t,r){void 0!==r&&(e[t]=n(e[t]+r),e[t+1]=n(e[t+1]+r),e[t+2]=n(e[t+2]+r))}function a(e,t,r){void 0!==r&&(e[t]=n(r*(e[t]-128)+128),e[t+1]=n(r*(e[t+1]-128)+128),e[t+2]=n(r*(e[t+2]-128)+128))}function l(e,t,r){void 0!==r&&(e[t]=n(Math.exp(Math.log(255*(e[t]/255))*r)),e[t+1]=n(Math.exp(Math.log(255*(e[t+1]/255))*r)),e[t+2]=n(Math.exp(Math.log(255*(e[t+2]/255))*r)))}function c(e,t,r,i){if(d.indexOf(r)===-1)throw new Error("Unsupported grayscale algorithm: "+r);if("none"===r)return null;var s=void 0,o=e[t],a=e[t+1],l=e[t+2];switch(r){case"average":s=(o+a+l)/3;break;case"luma":s=.3*o+.59*a+.11*l;break;case"luma-601":s=.299*o+.587*a+.114*l;break;case"luma-709":s=.2126*o+.7152*a+.0722*l;break;case"luma-240":s=.212*o+.701*a+.087*l;break;case"desaturation":s=(Math.max(o,a,l)+Math.min(o,a,l))/2;break;case"decomposition-min":s=Math.min(o,a,l);break;case"decomposition-max":s=Math.max(o,a,l);break;case"red-chanel":s=o;break;case"green-chanel":s=a;break;case"blue-chanel":s=l}void 0!==i&&(s=parseInt(s/i)*i),s=parseInt(s),e[t]=n(s),e[t+1]=n(s),e[t+2]=n(s)}function h(e,t){t=Object.assign({},{smoothing:!1,brightness:0,contrast:0,gamma:0,grayscale:"none",shadesOfGray:256,invertColor:!1,dithering:!1},t||{});var r=e.getContext("2d");void 0!==r.imageSmoothingEnabled?r.imageSmoothingEnabled=t.smoothing:(r.mozImageSmoothingEnabled=t.smoothing,r.webkitImageSmoothingEnabled=t.smoothing,r.msImageSmoothingEnabled=t.smoothing,r.oImageSmoothingEnabled=t.smoothing);var i=r.getImageData(0,0,e.width,e.height),n=i.data,h=void 0,u=void 0,d=void 0,p=void 0;0!==t.contrast&&(h=259*(t.contrast+255)/(255*(259-t.contrast))),0!==t.brightness&&(u=t.brightness),0!==t.gamma&&(d=1/t.gamma),t.shadesOfGray>1&&t.shadesOfGray<256&&(p=255/(t.shadesOfGray-1));for(var g=0,_=n.length;g<_;g+=4)s(n,g,t.invertColor),o(n,g,u),a(n,g,h),l(n,g,d),c(n,g,t.grayscale,p);t.dithering&&(i=(0,f.default)(i)),r.putImageData(i,0,0)}Object.defineProperty(t,"__esModule",{value:!0}),t.canvasFilters=void 0;var u=r(4),f=i(u),d=["none","average","desaturation","decomposition-min","decomposition-max","luma","luma-601","luma-709","luma-240","red-chanel","green-chanel","blue-chanel"];t.canvasFilters=h;var p=h;t.default=p;(function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(d,"grayscaleAlgorithms","/Users/jorgerobles/repos_1/LaserWeb4/src/lib/lw.raster2gcode/canvas-filters.js"),__REACT_HOT_LOADER__.register(n,"color","/Users/jorgerobles/repos_1/LaserWeb4/src/lib/lw.raster2gcode/canvas-filters.js"),__REACT_HOT_LOADER__.register(s,"invertColor","/Users/jorgerobles/repos_1/LaserWeb4/src/lib/lw.raster2gcode/canvas-filters.js"),__REACT_HOT_LOADER__.register(o,"brightness","/Users/jorgerobles/repos_1/LaserWeb4/src/lib/lw.raster2gcode/canvas-filters.js"),__REACT_HOT_LOADER__.register(a,"contrast","/Users/jorgerobles/repos_1/LaserWeb4/src/lib/lw.raster2gcode/canvas-filters.js"),__REACT_HOT_LOADER__.register(l,"gamma","/Users/jorgerobles/repos_1/LaserWeb4/src/lib/lw.raster2gcode/canvas-filters.js"),__REACT_HOT_LOADER__.register(c,"grayscale","/Users/jorgerobles/repos_1/LaserWeb4/src/lib/lw.raster2gcode/canvas-filters.js"),__REACT_HOT_LOADER__.register(h,"canvasFilters","/Users/jorgerobles/repos_1/LaserWeb4/src/lib/lw.raster2gcode/canvas-filters.js"),__REACT_HOT_LOADER__.register(p,"default","/Users/jorgerobles/repos_1/LaserWeb4/src/lib/lw.raster2gcode/canvas-filters.js"))})()},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasGrid=void 0;var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=r(1),a=i(o),l=function(){function e(t){n(this,e),this.cellSize=1024,this.scaleRatio={x:1,y:1},this.filters={},Object.assign(this,t||{}),this.scaleRatio.x||(this.scaleRatio={x:this.scaleRatio,y:this.scaleRatio}),this.size={width:0,height:0,cols:0,rows:0},this.file=null,this.image=null,this.url=null,this.canvas=[],this.pixels=[]}return s(e,[{key:"load",value:function(e){return e instanceof File?this.loadFromFile(e):e instanceof Image?this.loadFromImage(e):"string"==typeof e||e instanceof URL?this.loadFromURL(e.trim()):Promise.reject(new Error("Unsupported input format."))}},{key:"_loadImage",value:function(e,t,r){var i=this,n=new Image;n.onload=function(e){i.loadFromImage(n).then(r).catch(t)},n.onerror=function(r){t(new Error("An error occurred while loading the image : "+e))},n.src=e}},{key:"loadFromFile",value:function(e){var t=this;return new Promise(function(r,i){e instanceof File||i(new Error("Input param must be a File object.")),t.file=e,t._loadImage(URL.createObjectURL(e),i,r)})}},{key:"loadFromURL",value:function(e){var t=this;return new Promise(function(r,i){e instanceof URL||"string"==typeof e||i(new Error("Input param must be a URL string or object."));var n=e instanceof URL?e:new URL(e);t.url=n,t._loadImage(n,i,r)})}},{key:"loadFromImage",value:function(e){var t=this;return new Promise(function(r,i){e instanceof Image||i(new Error("Input param must be a Image object.")),t.image=e,t._processImage(),r(t)})}},{key:"_processImage",value:function(){this.canvas=[],this.pixels=[];var e=Math.round(this.image.width*this.scaleRatio.x),t=Math.round(this.image.height*this.scaleRatio.y),r=Math.ceil(e/this.cellSize),i=Math.ceil(t/this.cellSize);this.size={width:e,height:t,cols:r,rows:i};var n=null,s=null,o=null,l=null,c=null,h=null,u=null,f=null,d=null,p=null;for(h=0;h<this.size.rows;h++){for(n=[],o=[],c=0;c<this.size.cols;c++)s=document.createElement("canvas"),0===c||c<this.size.cols-1?s.width=this.size.width<this.cellSize?this.size.width:this.cellSize:s.width=this.size.width%this.cellSize,0===h||h<this.size.rows-1?s.height=this.size.height<this.cellSize?this.size.height:this.cellSize:s.height=this.size.height%this.cellSize,l=s.getContext("2d"),l.fillStyle="white",l.fillRect(0,0,s.width,s.height),d=s.width/this.scaleRatio.x,p=s.height/this.scaleRatio.y,u=c*this.cellSize/this.scaleRatio.x,f=h*this.cellSize/this.scaleRatio.y,l.drawImage(this.image,u,f,d,p,0,0,s.width,s.height),(0,a.default)(s,this.filters),n.push(s),o.push(l.getImageData(0,0,s.width,s.height).data);this.pixels.push(o),this.canvas.push(n)}}},{key:"getPixel",value:function(e,t){if(e=parseInt(e),t=parseInt(t),isNaN(e)||isNaN(t))throw new Error("[x, y] params must be Integer.");if(e<0||e>=this.size.width)throw new Error("Out of range: x = "+e+", max: "+this.size.width);if(t<0||t>=this.size.height)throw new Error("Out of range: y = "+t+", max: "+this.size.height);var r=parseInt(e/this.cellSize),i=parseInt(t/this.cellSize);r&&(e-=this.cellSize*r),i&&(t-=this.cellSize*i);var n=this.cellSize;this.size.width<n?n=this.size.width:this.size.width<n*(r+1)&&(n=this.size.width%n);var s=t*(4*n)+4*e,o=this.pixels[i][r],a=o.slice(s,s+4);return{color:{r:a[0],g:a[1],b:a[2],a:a[3]},gray:(a[0]+a[1]+a[2])/3,grid:{col:r,row:i},coords:{x:e,y:t}}}}]),e}();t.CanvasGrid=l;var c=l;t.default=c;(function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(l,"CanvasGrid","/Users/jorgerobles/repos_1/LaserWeb4/src/lib/lw.raster2gcode/canvas-grid.js"),__REACT_HOT_LOADER__.register(c,"default","/Users/jorgerobles/repos_1/LaserWeb4/src/lib/lw.raster2gcode/canvas-grid.js"))})()},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.RasterToGcode=void 0;var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),c=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,r,i)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},h=r(2),u=i(h),f=function(e){function t(e){n(this,t),e=Object.assign({ppi:{x:254,y:254},toolDiameter:.1,rapidRate:1500,feedRate:500,rateUnit:"mm/min",beamRange:{min:0,max:1},beamPower:{min:0,max:100},milling:!1,zSafe:5,zSurface:0,zDepth:-10,passDepth:1,offsets:{X:0,Y:0},trimLine:!0,joinPixel:!0,burnWhite:!0,verboseG:!1,diagonal:!1,overscan:0,precision:{X:2,Y:2,S:4},nonBlocking:!0,filters:{smoothing:0,brightness:0,contrast:0,gamma:0,grayscale:"none",shadesOfGray:256,invertColor:!1},onProgress:null,onProgressContext:null,onDone:null,onDoneContext:null,onAbort:null,onAbortContext:null},e||{});var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(r.milling){if(r.zSafe<r.zSurface)throw new Error('"zSafe" must be greater to "zSurface"');r.passes=Math.abs(Math.floor(r.zDepth/r.passDepth))}if(r.toolDiameter<=0)throw new Error('"toolDiameter" must be positive');return r.ppi.x||(r.ppi={x:r.ppi,y:r.ppi}),r.ppm={x:parseFloat((2540/(100*r.ppi.x)).toFixed(10)),y:parseFloat((2540/(100*r.ppi.y)).toFixed(10))},r.scaleRatio={x:r.ppm.x/r.toolDiameter,y:r.ppm.y/r.toolDiameter},r.running=!1,r.gcode=null,r.gcodes=null,r.currentLine=null,r.lastCommands=null,r.outputSize={width:0,height:0},r.G1=["G",1],r.G0=["G",r.burnWhite?1:0],r.beamOffset=1e3*r.toolDiameter/2e3,r.realBeamRange={min:r.beamRange.max/100*r.beamPower.min,max:r.beamRange.max/100*r.beamPower.max},"mm/sec"===r.rateUnit&&(r.feedRate*=60,r.rapidRate&&(r.rapidRate*=60)),r._registerUserCallbacks(r),r}return o(t,e),l(t,[{key:"_registerUserCallbacks",value:function(e){e.onProgress&&this.on("progress",e.onProgress,e.onProgressContext),e.onAbort&&this.on("abort",e.onAbort,e.onAbortContext),e.onDone&&this.on("done",e.onDone,e.onDoneContext)}},{key:"_processImage",value:function(){c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processImage",this).call(this),this.outputSize={width:this.size.width*(1e3*this.toolDiameter)/1e3,height:this.size.height*(1e3*this.toolDiameter)/1e3}}},{key:"abort",value:function(){this.running=!1}},{key:"run",value:function(e){if(!this.running){this.running=!0,this.gcode=[],this.gcodes=[],this.lastCommands={},this.currentLine=null,e=e||{},this._registerUserCallbacks(e);var t=this.nonBlocking;return void 0!==e.nonBlocking&&(t=e.nonBlocking),this._addHeader(),this.diagonal?this._scanDiagonally(t):this._scanHorizontally(t),t?void 0:this.gcode}}},{key:"_addHeader",value:function(){this.gcode.push("; Generated by LaserWeb (lw.raster-to-gcode.js)","; Size       : "+this.outputSize.width+" x "+this.outputSize.height+" mm","; PPI        : x: "+this.ppi.x+" - y: "+this.ppi.y,"; PPM        : x: "+this.ppm.x+" - y: "+this.ppm.y,"; Tool diam. : "+this.toolDiameter+" mm","; Feed rate  : "+this.feedRate+" "+this.rateUnit),this.rapidRate&&this.gcode.push("; Rapid rate  : "+this.rapidRate+" "+this.rateUnit),this.milling?this.gcode.push("; Z safe     : "+this.zSafe,"; Z surface  : "+this.zSurface,"; Z depth    : "+this.zDepth):this.gcode.push("; Beam range : "+this.beamRange.min+" to "+this.beamRange.max,"; Beam power : "+this.beamPower.min+" to "+this.beamPower.max+" %");for(var e=["smoothing","trimLine","joinPixel","burnWhite","verboseG","diagonal"],t=e.length-1;t>=0;t--)this[e[t]]||e.splice(t,1);e.length&&this.gcode.push("; Options    : "+e.join(", ")),this.gcode.push(""),this.rapidRate&&this.gcode.push("G0 F"+this.rapidRate),this.gcode.push("G1 F"+this.feedRate),this.gcode.push("")}},{key:"_mapPixelPower",value:function(e){var t=this.milling?{min:0,max:this.zDepth}:this.realBeamRange;return e*(t.max-t.min)/255+t.min}},{key:"_command",value:function(e,t){if("object"===("undefined"==typeof t?"undefined":a(t))){for(var r=Array.prototype.slice.call(arguments),i=void 0,n=[],s=0,o=r.length;s<o;s++)i=this._command.apply(this,r[s]),i&&n.push(i);return n.length?n.join(" "):null}return t=t.toFixed(this.precision[e]||0),this.verboseG||t!==this.lastCommands[e]?(this.lastCommands[e]=t,e+t):null}},{key:"_getPixelPower",value:function(e,t,r){try{t=this.size.height-t-1;var i=this.getPixel(e,t);return 255-i.gray}catch(e){if(3===arguments.length)return r;throw e}}},{key:"_getPoint",value:function(e){var t=this.currentLine[e];return t?(t.G=t.s?["G",1]:this.G0,t.X=t.x*this.toolDiameter+this.offsets.X,t.Y=t.y*this.toolDiameter+this.offsets.Y,t.S=this._mapPixelPower(t.s),this.diagonal?(t.Y+=this.toolDiameter,t.first||t.lastWhite?(t.X+=this.beamOffset,t.Y-=this.beamOffset):(t.last||t.lastColored)&&(t.X-=this.beamOffset,t.Y+=this.beamOffset)):(t.Y+=this.beamOffset,t.first||t.lastWhite?t.X+=this.beamOffset:(t.last||t.lastColored)&&(t.X-=this.beamOffset)),t):null}},{key:"_trimCurrentLine",value:function(){for(var e=this.currentLine[0];e&&!e.p;)this.currentLine.shift(),e=this.currentLine[0];for(e=this.currentLine[this.currentLine.length-2];e&&!e.p;)this.currentLine.pop(),e=this.currentLine[this.currentLine.length-2];return this.currentLine.length}},{key:"_reduceCurrentLine",value:function(){if(this.currentLine.length<3)return this.currentLine.length;for(var e,t=this.currentLine.splice(1),r=this.currentLine[0].p,i=0,n=t.length-1;i<n;i++)e=t[i],r!==e.p&&this.currentLine.push(e),r=e.p;this.currentLine.push(t[i])}},{key:"_overscanCurrentLine",value:function(e){var t=this.overscan/this.ppm.x,r=this.currentLine[0],i=this.currentLine[this.currentLine.length-1];r.s&&(r.lastWhite=!0),i.s&&(i.lastColored=!0),e?i.s=0:r.s=0;var n={x:i.x+t,y:i.y,s:0,p:0},s={x:r.x-t,y:r.y,s:0,p:0};this.diagonal&&(s.y+=t,n.y-=t),this.currentLine.unshift(s),this.currentLine.push(n)}},{key:"_processCurrentLine",value:function(e){return this.milling?this._processMillingLine(e):this._processLaserLine(e)}},{key:"_processMillingLine",value:function(e){var t=this;if(!this._trimCurrentLine())return null;this.joinPixel&&this._reduceCurrentLine(),this.currentLine[0].first=!0,this.currentLine[this.currentLine.length-1].last=!0,e&&(this.currentLine=this.currentLine.reverse());var r=void 0,i=0,n=void 0,s=[],o=function(){n=t._command.apply(t,arguments),n&&s.push(n)};r=this._getPoint(i);for(var a=!1,l=void 0,c=void 0,h=function(e){for(o(["G",0],["Z",t.zSafe]),o(["G",0],["X",r.X],["Y",r.Y]),o(["G",0],["Z",t.zSurface]);r;)r.S?(a&&(o(["G",0],["Z",t.zSurface]),a=!1),l=r.S,c=t.passDepth*e,e<t.passes&&(l=Math.max(l,-c)),o(["G",1],["Z",t.zSurface+l]),o(["G",1],["X",r.X],["Y",r.Y])):(a&&(o(["G",1],["Z",t.zSurface]),a=!1),o(["G",0],["Z",t.zSafe]),o(["G",0],["X",r.X],["Y",r.Y])),(r.lastWhite||r.lastColored)&&(a=!0),r=t._getPoint(++i);o(["G",1],["Z",t.zSurface]),o(["G",0],["Z",t.zSafe])},u=1;u<=this.passes&&(h(u),s.length);u++)this.gcodes.length<u?this.gcodes.push([]):this.gcodes[u-1].push.apply(this.gcodes[u-1],s),i=0,s=[],r=this._getPoint(i),this.lastCommands={};return null}},{key:"_processLaserLine",value:function(e){var t=this;if(this.trimLine&&!this._trimCurrentLine())return null;this.joinPixel&&this._reduceCurrentLine(),this.overscan&&this._overscanCurrentLine(e),this.currentLine[0].first=!0,this.currentLine[this.currentLine.length-1].last=!0,e&&(this.currentLine=this.currentLine.reverse());var r=void 0,i=0,n=void 0,s=[],o=function(){n=t._command.apply(t,arguments),n&&s.push(n)};for(r=this._getPoint(i),o(this.G0,["X",r.X],["Y",r.Y],["S",0]),r=this._getPoint(++i);r;)o(r.G,["X",r.X],["Y",r.Y],["S",r.S]),r=this._getPoint(++i);return s.length?s:null}},{key:"_scanHorizontally",value:function(e){var t=this,r=0,i=0,n=void 0,s=void 0,o=void 0,a=void 0,l=this.size.width,c=this.size.height,h=!1,u=!1,f=!1,d=function(){for(t.currentLine=[],o=null,r=0;r<=l;r++)n=s=t._getPixelPower(r,i,s),u=o&&!o.p&&s,f=o&&o.p&&!s,!h&&o&&(n=o.p),o={x:r,y:i,s:n,p:s},u&&(o.lastWhite=!0),f&&(o.lastColored=!0),t.currentLine.push(o)},p=0,g=0,_=function(){a=t._processCurrentLine(h),p=Math.round(i/c*100),p>g&&t._onProgress({gcode:a,percent:p}),g=p,a&&(h=!h,t.gcode.push.apply(t.gcode,a))},m=function r(){return t.running?(d(),_(),i++,void(i<c?e?setTimeout(r,0):r():(t.milling&&t.gcodes.forEach(function(e){t.gcode.push.apply(t.gcode,e)}),t._onDone({gcode:t.gcode}),t.running=!1))):t._onAbort()};m()}},{key:"_scanDiagonally",value:function(e){var t=this,r=0,i=0,n=void 0,s=void 0,o=void 0,a=void 0,l=this.size.width,c=this.size.height,h=l+c-1,u=0,f=!1,d=!1,p=!1,g=function(e,r){for(t.currentLine=[],o=null,u++;;){if(r<-1||r==c)break;if(e<0||e>l)break;n=s=t._getPixelPower(e,r,s),d=o&&!o.p&&s,p=o&&o.p&&!s,!f&&o&&(n=o.p),o={x:e,y:r,s:n,p:s},d&&(o.lastWhite=!0),p&&(o.lastColored=!0),t.currentLine.push(o),e++,r--}},_=0,m=0,v=function(){a=t._processCurrentLine(f),_=Math.round(u/h*100),_>m&&t._onProgress({gcode:a,percent:_}),m=_,a&&(f=!f,t.gcode.push.apply(t.gcode,a))},b=function n(){return t.running?(g(r,i),v(),r?r++:i++,i===c&&(r++,i--),void(i<c&&r<l?e?setTimeout(n,0):n():(t._onDone({gcode:t.gcode}),t.running=!1))):t._onAbort()};b()}},{key:"_onProgress",value:function(e){}},{key:"_onDone",value:function(e){}},{key:"_onAbort",value:function(){}},{key:"on",value:function(e,t,r){var i=this,n="_on"+e[0].toUpperCase()+e.slice(1);if(!this[n]||"function"!=typeof this[n])throw new Error("Undefined event: "+e);return this[n]=function(e){return t.call(r||i,e)},this}},{key:"getHeightMap",value:function(e){var t=this;if(!this.running){this.running=!0;var r=[],i=0,n=0,s=this.size.width,o=this.size.height,a=0,l=0;e=e||{},this._registerUserCallbacks(e);var c=this.nonBlocking;void 0!==e.nonBlocking&&(c=e.nonBlocking);var h=function(){var e=[];for(i=0;i<s;i++)e.push(t._mapPixelPower(t._getPixelPower(i,n)));a=Math.round(n/o*100),a>l&&t._onProgress({pixels:e,percent:a}),l=a,r.push(e)},u=function e(){return t.running?(h(),n++,void(n<o?c?setTimeout(e,0):e():(t._onDone({heightMap:r}),t.running=!1))):t._onAbort()};return u(),c?void 0:r}}}]),t}(u.default);t.RasterToGcode=f;var d=f;t.default=d;(function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(f,"RasterToGcode","/Users/jorgerobles/repos_1/LaserWeb4/src/lib/lw.raster2gcode/raster-to-gcode.js"),__REACT_HOT_LOADER__.register(d,"default","/Users/jorgerobles/repos_1/LaserWeb4/src/lib/lw.raster2gcode/raster-to-gcode.js"))})()},function(e,t){function r(e){for(var t,r,i=e.data,n=i.length,s=e.width,o=[],a=[],l=[],c=0;c<256;c++)o[c]=.299*c,a[c]=.587*c,l[c]=.11*c;for(var c=0;c<=n;c+=4)i[c]=Math.floor(o[i[c]]+a[i[c+1]]+l[i[c+2]]);for(var h=0;h<=n;h+=4)t=i[h]<150?0:255,r=Math.floor((i[h]-t)/23),i[h]=t,i[h+4]+=7*r,i[h+4*s-4]+=3*r,i[h+4*s]+=5*r,i[h+4*s+4]+=1*r,i[h+1]=i[h+2]=i[h];return e}e.exports=r}]);
//# sourceMappingURL=ec6ef5e051fb1735e264.worker.js.map